@startuml ホーム画面状態遷移図

title ヨルノートアプリ - ホーム画面状態遷移図

[*] --> HomeView表示

state HomeView表示 {
    [*] --> 初期化処理
    初期化処理 --> エントリ検索実行
    エントリ検索実行 --> 日付選択待機
    
    state 日付選択待機 {
        [*] --> DatePicker表示
        DatePicker表示 --> 日付変更検知 : ユーザーが日付選択
        日付変更検知 --> エントリ検索実行
    }
    
    state エントリ検索実行 {
        [*] --> データベース検索
        データベース検索 --> 記録あり判定 : エントリが存在
        データベース検索 --> 記録なし判定 : エントリが存在しない
    }
    
    state 記録あり判定 {
        [*] --> エントリ内容表示
        エントリ内容表示 --> 内容確認ボタン表示
        内容確認ボタン表示 --> 儀式画面遷移 : "内容を確認する"タップ
    }
    
    state 記録なし判定 {
        [*] --> 記録なしメッセージ表示
        記録なしメッセージ表示 --> 今日判定
        今日判定 --> 儀式開始ボタン表示 : 選択日が今日
        今日判定 --> 日付選択待機 : 選択日が今日以外
        儀式開始ボタン表示 --> RitualInputView表示 : "今日の儀式を始める"タップ
    }
    
    儀式画面遷移 --> RitualInputView表示
}

state RitualInputView表示 {
    [*] --> シート表示
    シート表示 --> HomeView表示 : シート閉じる
}

note right of エントリ検索実行
  Calendar.current.isDate(_:inSameDayAs:)
  を使用して日付比較
end note

note right of 儀式開始ボタン表示
  日時が今日の場合のみ表示
end note

@enduml